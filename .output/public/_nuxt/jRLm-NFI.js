import{P as d,Q as u}from"#entry";const h=()=>{const n=d(),a=n.public.apiBaseUrl,s=n.public.token,r={"Content-Type":"application/json",Accept:"application/json"};return{GET:async(t,o)=>{let e=t;return e=e.replace("{alias}",s),o&&e.includes("id}")&&(e=e.replace("{id}",o.toString())),await(await fetch(`${a}${e}`,{method:"GET",headers:r})).json()},POST:async(t,o)=>{let e=t;return e=e.replace("{alias}",s),(await fetch(`${a}${e}`,{method:"POST",headers:r,body:JSON.stringify(o)})).json()}}},f=()=>{function n(t=""){return t.replace(/<(?!\/?br\s*\/?>)[^>]+>/gi,"")}function a(t,o=!1){const e=i=>o?i:n(i);return t.map(i=>{switch(i.type){case"paragraph":return`<p>${e(i.data.text)}</p>`;case"header":{const c=i.data.level;return`<h${c}>${e(i.data.text)}</h${c}>`}case"quote":{const c=i.data.caption?`<cite>${e(i.data.caption)}</cite>`:"";return`<blockquote>${e(i.data.text)}${c}</blockquote>`}}}).join("")}function s(t,o,e){return t.trim().length<=e&&t.trim().length>=o}function r(t){return new Date(t).toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}function l(t){return{id:t.id,title:t.title,description:t.short_description??"",createdAt:Date.parse(t.datetime),html:t.description_html??"",blocks:t.description_json?JSON.parse(t.description_json):[]}}function p(t){return{id:t.id,title:t.title,datetime:new Date(t.createdAt??Date.now()).toISOString(),...t.blocks&&{description_html:a(t.blocks),description_json:JSON.stringify(t.blocks)},...t.description&&{short_description:t.description}}}return{escapeHtml:n,validateTextLength:s,convertToHTML:a,convertDate:r,makeMaterialType:l,makeMaterialRawType:p}},{makeMaterialType:g,makeMaterialRawType:m}=f(),T=u("UseMaterial",{state:()=>({materials:[],apiClient:null,editingMaterial:null}),actions:{getApiClient(){return this.apiClient||(this.apiClient=h()),this.apiClient},async getMaterialById(n){const a=this.materials.find(r=>r.id===n);if(a)return a;await this.fetchAllMaterials();const s=this.materials.find(r=>r.id===n);return s||Promise.reject(new Error)},async fetchAllMaterials(){const a=await this.getApiClient().GET("/materials/{alias}");this.materials=a.map(s=>g(s))},async saveMaterial(n){await this.getApiClient().POST("/materials/{alias}/save",m(n)),await this.fetchAllMaterials()}}});export{T as U,f as a};
